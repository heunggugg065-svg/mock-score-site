<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ScoreBoard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#111827,#4f46e5);margin:0;padding:20px}
    .container{max-width:980px;margin:auto;background:#fff;padding:22px 22px 26px;border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,.25);position:relative}
    h1{margin:6px 0 14px;text-align:center}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-size:12px;margin:6px 0}
    .top-right{position:absolute;top:14px;right:16px;display:flex;gap:10px;align-items:center}
    .link-btn{font-size:12px;color:#4f46e5;cursor:pointer;user-select:none}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1 1 180px}
    input,select,button{padding:10px;margin:6px 0;width:100%;box-sizing:border-box;border-radius:10px;border:1px solid #d1d5db}
    button{background:#4f46e5;color:#fff;border:none;cursor:pointer;font-weight:700}
    button:hover{background:#4338ca}
    .ghost{background:#111827}
    .ghost:hover{background:#0b1220}
    .section{margin-top:18px;padding:14px;border:1px solid #eef2ff;border-radius:14px;background:#fafbff}
    .section h3{margin:0 0 10px}
    table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;border-radius:12px;overflow:hidden}
    th,td{border-bottom:1px solid #eee;padding:10px;text-align:center}
    th{background:#f3f4f6}
    .muted{color:#6b7280;font-size:12px}
    .hidden{display:none !important}
    .cards{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width: 720px){.cards{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:12px}
    .card .t{font-weight:700;margin-bottom:4px}
    .card .d{font-size:13px;color:#374151}
    canvas{margin-top:14px}
    .danger{background:#dc2626}
    .danger:hover{background:#b91c1c}
  </style>
</head>
<body>
  <div class="container">
    <div class="top-right">
      <span id="manageTab" class="link-btn hidden">ê´€ë¦¬</span>
      <span id="logoutBtn" class="link-btn hidden">ë¡œê·¸ì•„ì›ƒ</span>
    </div>

    <h1>ğŸ“Š ScoreBoard</h1>
    <div id="roleBadge" class="badge hidden"></div>

    <!-- ë¡œê·¸ì¸ -->
    <div id="loginSection" class="section">
      <h3>ğŸ” ë¡œê·¸ì¸</h3>
      <input id="pwInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
      <button id="loginBtn">ë¡œê·¸ì¸</button>
    </div>

    <!-- ì ìˆ˜ (ëª¨ë“  ë“±ê¸‰ ë³´ê¸° ê°€ëŠ¥, ì˜ë§Œ ìˆ˜ì •/ì¶”ê°€/ì‚­ì œ) -->
    <div id="scoresSection" class="section hidden">
      <h3>ğŸ“ˆ ì ìˆ˜</h3>

      <div id="scoreEditor" class="hidden">
        <div class="row">
          <input id="examName" placeholder="ì‹œí—˜ ì´ë¦„ (ì˜ˆ: 3ì›” í•™í‰ 1íšŒ)" />
          <input id="korean" type="number" placeholder="êµ­ì–´" />
          <input id="math" type="number" placeholder="ìˆ˜í•™" />
          <input id="english" type="number" placeholder="ì˜ì–´" />
        </div>
        <button id="addScoreBtn">ì ìˆ˜ ì¶”ê°€</button>
        <div class="muted">* ì ìˆ˜ ì¶”ê°€/ì‚­ì œëŠ” <b>ì˜</b> ë“±ê¸‰ë§Œ ê°€ëŠ¥</div>
      </div>

      <table>
        <thead>
          <tr>
            <th>ì‹œí—˜</th><th>êµ­ì–´</th><th>ìˆ˜í•™</th><th>ì˜ì–´</th><th>ì´ì </th>
            <th id="delColHead" class="hidden">ì‚­ì œ</th>
          </tr>
        </thead>
        <tbody id="scoreTable"></tbody>
      </table>

      <canvas id="scoreChart"></canvas>
    </div>

    <!-- ëŒ€í•™ì •ë³´: í•œ ì´ìƒ(í•œ/ì¹˜/ì˜) -->
    <div id="universitySection" class="section hidden">
      <h3>ğŸ“ ëŒ€í•™ì •ë³´ (í•œ ì´ìƒ)</h3>
      <div class="muted">ë‚˜ì¤‘ì— ë„ˆê°€ ì£¼ëŠ” â€œë°±ë¶„ìœ„ë³„ ëŒ€í•™ ë¦¬ìŠ¤íŠ¸â€ë¥¼ ë„£ìœ¼ë©´ ì—¬ê¸° ì¹´ë“œë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ í•´ë‘˜ê²Œ.</div>
      <div class="cards" id="univCards">
        <div class="card">
          <div class="t">ì˜ˆì‹œ) ìƒìœ„ê¶Œ ëŒ€í•™</div>
          <div class="d">ë°±ë¶„ìœ„ 96+ â†’ â—‹â—‹ëŒ€, â–³â–³ëŒ€ â€¦</div>
        </div>
        <div class="card">
          <div class="t">ì˜ˆì‹œ) ì¤‘ìƒìœ„ê¶Œ ëŒ€í•™</div>
          <div class="d">ë°±ë¶„ìœ„ 90+ â†’ â–¡â–¡ëŒ€, â—‡â—‡ëŒ€ â€¦</div>
        </div>
      </div>
    </div>

    <!-- 2026 ì •ë³´: ì¹˜ ì´ìƒ(ì¹˜/ì˜) -->
    <div id="info2026Section" class="section hidden">
      <h3>ğŸ—“ 2026í•™ë…„ë„ ì‹¤ëª¨/ì‹œí—˜ ì •ë³´ (ì¹˜ ì´ìƒ)</h3>
      <div class="cards">
        <div class="card">
          <div class="t">ì˜ˆì‹œ) 2026 í•™í‰ ì¼ì •</div>
          <div class="d">ì—¬ê¸°ì— 2026 ê´€ë ¨ í•µì‹¬ ìë£Œë¥¼ ì¹´ë“œë¡œ ì •ë¦¬</div>
        </div>
        <div class="card">
          <div class="t">ì˜ˆì‹œ) 2026 ì‹¤ëª¨ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
          <div class="d">ì˜¤ë‹µ/ì‹œê°„ê´€ë¦¬/ì „ëµ ë©”ëª¨ ë“±</div>
        </div>
      </div>
    </div>

    <!-- ìë£Œì‹¤: ìƒìœ„ ë“±ê¸‰ì´ í•˜ìœ„ ë“±ê¸‰ ìë£Œê¹Œì§€ ì—´ëŒ -->
    <div id="materialsSection" class="section hidden">
      <h3>ğŸ“š ì£¼ìš”ìë£Œ</h3>
      <div class="muted">ë“±ê¸‰ì´ ë†’ì„ìˆ˜ë¡ ë” ë§ì´ ë´„ (ì˜>ì¹˜>í•œ>ì•½>ìˆ˜)</div>
      <div class="cards">
        <div class="card" data-grade="ì¹˜">
          <div class="t">ì¹˜ ë“±ê¸‰ ìë£Œ</div>
          <div class="d">ì¹˜ ì´ìƒë§Œ ë³´ì´ê²Œ ì„¤ì •ëœ ì¹´ë“œ</div>
        </div>
        <div class="card" data-grade="í•œ">
          <div class="t">í•œ ë“±ê¸‰ ìë£Œ</div>
          <div class="d">í•œ ì´ìƒì—ê²Œ ë³´ì´ëŠ” ì¹´ë“œ</div>
        </div>
        <div class="card" data-grade="ì•½">
          <div class="t">ì•½ ë“±ê¸‰ ìë£Œ</div>
          <div class="d">ì•½ ì´ìƒì—ê²Œ ë³´ì´ëŠ” ì¹´ë“œ</div>
        </div>
        <div class="card" data-grade="ìˆ˜">
          <div class="t">ìˆ˜ ë“±ê¸‰ ìë£Œ</div>
          <div class="d">ìˆ˜ ì´ìƒ(=ëª¨ë‘)ì—ê²Œ ë³´ì´ëŠ” ì¹´ë“œ</div>
        </div>
      </div>
    </div>

    <!-- ê´€ë¦¬(ì˜ ì „ìš©): ê³„ì •/ê¶Œí•œ + ë¡œê·¸ì¸ ê¸°ë¡ -->
    <div id="manageSection" class="section hidden">
      <h3>ğŸ›  ê´€ë¦¬ (ì˜ ì „ìš©)</h3>

      <div class="section" style="background:#fff">
        <h3 style="margin-bottom:6px">ğŸ‘¤ ë¹„ë°€ë²ˆí˜¸/ë“±ê¸‰ ë§Œë“¤ê¸°</h3>
        <div class="row">
          <input id="newPw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸(ì‚¬ëŒë³„ë¡œ)" />
          <select id="newGrade">
            <option value="ì¹˜">ì¹˜</option>
            <option value="í•œ">í•œ</option>
            <option value="ì•½">ì•½</option>
            <option value="ìˆ˜">ìˆ˜</option>
            <option value="ì˜">ì˜</option>
          </select>
        </div>
        <button id="addUserBtn" class="ghost">ì¶”ê°€</button>
        <div class="muted">* ë¹„ë°€ë²ˆí˜¸ëŠ” í™”ë©´ì— ê·¸ëŒ€ë¡œ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ (ëª©ë¡ì—” ****ë¡œ í‘œì‹œ)</div>
        <div id="userList" style="margin-top:10px"></div>
      </div>

      <div class="section" style="background:#fff">
        <h3 style="margin-bottom:6px">ğŸ§¾ ë¡œê·¸ì¸ ê¸°ë¡</h3>
        <div id="loginRecords" class="muted"></div>
        <button id="clearLogsBtn" class="danger">ë¡œê·¸ì¸ ê¸°ë¡ ì „ì²´ ì‚­ì œ</button>
      </div>
    </div>

  </div>

<script>
  // ===== ì €ì¥ í‚¤ =====
  const KEY_SCORES = "sb_scores";
  const KEY_USERS  = "sb_users";
  const KEY_LOGS   = "sb_login_records";

  // ===== ë“±ê¸‰ ê³„ì¸µ (ë†’ì„ìˆ˜ë¡ ìƒìœ„) =====
  const gradeHierarchy = { "ì˜": 5, "ì¹˜": 4, "í•œ": 3, "ì•½": 2, "ìˆ˜": 1 };

  // ===== ì´ˆê¸° ë°ì´í„° =====
  let scores = JSON.parse(localStorage.getItem(KEY_SCORES) || "[]");
  let users  = JSON.parse(localStorage.getItem(KEY_USERS)  || "null");
  if (!users) {
    users = { "0704160931": "ì˜" }; // ê¸°ë³¸ ì˜ ë¹„ë°€ë²ˆí˜¸
    localStorage.setItem(KEY_USERS, JSON.stringify(users));
  }

  let currentGrade = null;

  // ===== DOM =====
  const $ = (id) => document.getElementById(id);

  const loginSection = $("loginSection");
  const scoresSection = $("scoresSection");
  const scoreEditor = $("scoreEditor");
  const delColHead = $("delColHead");

  const universitySection = $("universitySection");
  const info2026Section = $("info2026Section");
  const materialsSection = $("materialsSection");

  const roleBadge = $("roleBadge");
  const manageTab = $("manageTab");
  const manageSection = $("manageSection");
  const logoutBtn = $("logoutBtn");

  // ===== ë¡œê·¸ì¸ ê¸°ë¡ =====
  function saveLoginRecord(grade) {
    const logs = JSON.parse(localStorage.getItem(KEY_LOGS) || "[]");
    logs.push({ grade, time: new Date().toLocaleString() });
    localStorage.setItem(KEY_LOGS, JSON.stringify(logs));
  }

  function renderLoginRecords() {
    if (currentGrade !== "ì˜") return;
    const logs = JSON.parse(localStorage.getItem(KEY_LOGS) || "[]");
    const box = $("loginRecords");
    if (!box) return;
    if (logs.length === 0) {
      box.innerText = "ê¸°ë¡ ì—†ìŒ";
      return;
    }
    box.innerHTML = logs.slice().reverse().map(l => `â€¢ [${l.time}] ë“±ê¸‰: ${l.grade}`).join("<br/>");
  }

  // ===== ê¶Œí•œ ì ìš© =====
  function applyPermissions() {
    const level = gradeHierarchy[currentGrade];

    // ê¸°ë³¸ í™”ë©´ ì—´ê¸°
    loginSection.classList.add("hidden");
    scoresSection.classList.remove("hidden");
    materialsSection.classList.remove("hidden");
    logoutBtn.classList.remove("hidden");

    roleBadge.classList.remove("hidden");
    roleBadge.textContent = `í˜„ì¬ ë“±ê¸‰: ${currentGrade}`;

    // ì˜ë§Œ ìˆ˜ì •/ì¶”ê°€/ì‚­ì œ + ê´€ë¦¬íƒ­
    const isUi = (currentGrade === "ì˜");
    scoreEditor.classList.toggle("hidden", !isUi);
    delColHead.classList.toggle("hidden", !isUi);
    manageTab.classList.toggle("hidden", !isUi);

    // ëŒ€í•™ì •ë³´: í•œ ì´ìƒ
    universitySection.classList.toggle("hidden", !(level >= gradeHierarchy["í•œ"]));

    // 2026 ì •ë³´: ì¹˜ ì´ìƒ
    info2026Section.classList.toggle("hidden", !(level >= gradeHierarchy["ì¹˜"]));

    // ìë£Œì‹¤ ì¹´ë“œ: ìƒìœ„ê°€ í•˜ìœ„ê¹Œì§€ ë´„
    document.querySelectorAll("[data-grade]").forEach(card => {
      const g = card.getAttribute("data-grade");
      const cardLevel = gradeHierarchy[g];
      card.style.display = (level >= cardLevel) ? "block" : "none";
    });

    // ì˜ë©´ ë¡œê·¸ì¸ê¸°ë¡ë„ ë³´ì—¬ì¤Œ(ê´€ë¦¬ ì—´ì—ˆì„ ë•Œ)
    if (isUi) renderLoginRecords();
  }

  // ===== ìŠ¤ì½”ì–´ ë Œë” =====
  function saveScores() {
    localStorage.setItem(KEY_SCORES, JSON.stringify(scores));
  }

  function renderTable() {
    const tbody = $("scoreTable");
    tbody.innerHTML = "";
    scores.forEach((s, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(s.examName)}</td>
        <td>${s.korean}</td>
        <td>${s.math}</td>
        <td>${s.english}</td>
        <td><b>${s.total}</b></td>
        ${currentGrade === "ì˜" ? `<td><button class="danger" onclick="deleteScore(${idx})">ì‚­ì œ</button></td>` : ""}
      `;
      tbody.appendChild(tr);
    });
  }

  window.deleteScore = function(idx) {
    if (currentGrade !== "ì˜") return;
    scores.splice(idx, 1);
    saveScores();
    renderTable();
    renderChart();
  }

  function renderChart() {
    const ctx = $("scoreChart").getContext("2d");
    const labels = scores.map(s => s.examName);
    const totals = scores.map(s => s.total);

    if (window.myChart) window.myChart.destroy();

    window.myChart = new Chart(ctx, {
      type: "line",
      data: { labels, datasets: [{ label: "ì´ì  ì¶”ì´", data: totals, fill: false }] },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });
  }

  // ===== ìœ ì €(ë¹„ë°€ë²ˆí˜¸/ë“±ê¸‰) ê´€ë¦¬ (ì˜ ì „ìš©) =====
  function saveUsers() {
    localStorage.setItem(KEY_USERS, JSON.stringify(users));
  }

  function renderUsers() {
    if (currentGrade !== "ì˜") return;
    const wrap = $("userList");
    wrap.innerHTML = "";

    Object.keys(users).forEach(pw => {
      const grade = users[pw];
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <div class="t">ë¹„ë°€ë²ˆí˜¸: ****</div>
        <div class="d">ë“±ê¸‰: <b>${grade}</b></div>
        <button class="danger" style="margin-top:8px" onclick="removeUser('${escapeAttr(pw)}')">ì‚­ì œ</button>
      `;
      // ê¸°ë³¸ ì˜ ë¹„ë²ˆ ì‚­ì œ ë°©ì§€(ì›í•˜ë©´ ë‚˜ì¤‘ì— í’€ì–´ì¤„ê²Œ)
      if (pw === "0704160931") {
        div.querySelector("button").disabled = true;
        div.querySelector("button").textContent = "ê¸°ë³¸ ì˜ ë¹„ë²ˆ(ì‚­ì œ ë¶ˆê°€)";
        div.querySelector("button").style.opacity = "0.6";
        div.querySelector("button").style.cursor = "not-allowed";
      }
      wrap.appendChild(div);
    });
  }

  window.removeUser = function(pw) {
    if (currentGrade !== "ì˜") return;
    if (pw === "0704160931") return;
    delete users[pw];
    saveUsers();
    renderUsers();
  }

  // ===== ì´ë²¤íŠ¸ =====
  $("loginBtn").addEventListener("click", () => {
    const pw = $("pwInput").value;
    const grade = users[pw];
    if (!grade) {
      alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      return;
    }
    currentGrade = grade;
    saveLoginRecord(currentGrade);
    applyPermissions();
    renderTable();
    renderChart();
  });

  $("addScoreBtn").addEventListener("click", () => {
    if (currentGrade !== "ì˜") return;

    const examName = $("examName").value.trim();
    const korean = parseInt($("korean").value, 10);
    const math = parseInt($("math").value, 10);
    const english = parseInt($("english").value, 10);

    if (!examName || [korean, math, english].some(v => Number.isNaN(v))) {
      alert("ì‹œí—˜ ì´ë¦„/ì ìˆ˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì¤˜.");
      return;
    }

    const total = korean + math + english;
    scores.push({ examName, korean, math, english, total });
    saveScores();

    $("examName").value = "";
    $("korean").value = "";
    $("math").value = "";
    $("english").value = "";

    renderTable();
    renderChart();
  });

  manageTab.addEventListener("click", () => {
    if (currentGrade !== "ì˜") return;
    manageSection.classList.toggle("hidden");
    renderUsers();
    renderLoginRecords();
  });

  $("addUserBtn").addEventListener("click", () => {
    if (currentGrade !== "ì˜") return;
    const pw = $("newPw").value.trim();
    const grade = $("newGrade").value;
    if (!pw) return alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì¤˜.");
    users[pw] = grade;
    saveUsers();
    $("newPw").value = "";
    renderUsers();
    alert(`ì¶”ê°€ë¨: ë“±ê¸‰ ${grade}`);
  });

  $("clearLogsBtn").addEventListener("click", () => {
    if (currentGrade !== "ì˜") return;
    localStorage.setItem(KEY_LOGS, "[]");
    renderLoginRecords();
  });

  logoutBtn.addEventListener("click", () => {
    currentGrade = null;
    // í™”ë©´ ë¦¬ì…‹
    loginSection.classList.remove("hidden");
    scoresSection.classList.add("hidden");
    universitySection.classList.add("hidden");
    info2026Section.classList.add("hidden");
    materialsSection.classList.add("hidden");
    manageSection.classList.add("hidden");
    roleBadge.classList.add("hidden");
    manageTab.classList.add("hidden");
    logoutBtn.classList.add("hidden");
    $("pwInput").value = "";
  });

  // ìœ í‹¸
  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }
  function escapeAttr(str){
    return String(str).replace(/['"\\\\]/g, "\\$&");
  }
</script>
</body>
</html>

